/*
 * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.
 */
package com.sap.hybris.sapcustomerb2c.outbound;

import de.hybris.bootstrap.annotations.IntegrationTest;
import de.hybris.platform.commerceservices.customer.CustomerAccountService;
import de.hybris.platform.commerceservices.customer.DuplicateUidException;
import de.hybris.platform.core.model.user.CustomerModel;
import de.hybris.platform.servicelayer.ServicelayerTest;
import org.junit.Before;
import org.junit.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;

import javax.annotation.Resource;

import static org.fest.assertions.Assertions.assertThat;

@IntegrationTest
public class DefaultB2CSapCustomerAccountServiceAspectTest extends ServicelayerTest {

  private static final String TEST_NEW_PASS = "newPass";
  private static final String REG_EXPRESSION = "[0-9]{1,10}";

  @Resource(name = "customerAccountService")
  private CustomerAccountService defaultCustomerAccountService;
  @Mock
  private CustomerModel customer;

  @Before
  public void setUp() {

    MockitoAnnotations.initMocks(this);
    customer = new CustomerModel();
    customer.setUid("customerUid");

  }

  @Test
  public void interceptRegister() throws DuplicateUidException {

    defaultCustomerAccountService.register(customer, TEST_NEW_PASS);
    // Assert that the customer Id has been generated by the sapCustomerIdGenerator
    assertThat(customer.getCustomerID().matches(REG_EXPRESSION)).isTrue();

  }

  @Test
  public void interceptRegisterGuestForAnonymousCheckout() throws DuplicateUidException {

    defaultCustomerAccountService.registerGuestForAnonymousCheckout(customer, TEST_NEW_PASS);
    // Assert that the customer Id has been generated by the sapCustomerIdGenerator
    assertThat(customer.getCustomerID().matches(REG_EXPRESSION)).isTrue();

  }

}